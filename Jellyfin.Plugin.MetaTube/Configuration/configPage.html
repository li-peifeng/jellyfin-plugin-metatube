<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>MetaTube</title>
</head>

<body>
<div class="page type-interior pluginConfigurationPage MetaTubeConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox,emby-linkbutton" data-role="page">
    <div data-role="content">
        <div class="content-primary">

            <h1>MetaTube</h1>

            <div class="readOnlyContent">
                <p class="description1">Jellyfin/Emby MetaTube 插件中文版。</p>
            </div>

            <form class="MetaTubeConfigurationForm">

                <div class="verticalSection">
                    <h2>通用</h2>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtServer">后端服务器:</label>
                        <input id="txtServer" is="emby-input" name="txtServer" pattern="^https?://.+$" required
                               type="text"/>
                        <div class="fieldDescription">MetaTube后端服务器的完整网址，推荐使用HTTPS。</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtToken">令牌:</label>
                        <input id="txtToken" is="emby-input" name="txtToken" type="text"/>
                        <div class="fieldDescription">后端服务器的访问令牌，如果后端没有设置令牌请留空。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableCollections" is="emby-checkbox" name="chkEnableCollections" type="checkbox"/>
                            <span>启用合集</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">按系列自动创建合集。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableDirectors" is="emby-checkbox" name="chkEnableDirectors" type="checkbox"/>
                            <span>启用导演</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">将导演添加到相应的视频元数据中。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableRatings" is="emby-checkbox" name="chkEnableRatings" type="checkbox"/>
                            <span>启用评分</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">显示原始网站的社区评分。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableTrailers" is="emby-checkbox" name="chkEnableTrailers" type="checkbox"/>
                            <span>启用预告片</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">生成strm格式的在线视频预告片。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableRealActorNames" is="emby-checkbox" name="chkEnableRealActorNames" type="checkbox"/>
                            <span>启用真实演员的名字</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">搜索并替换来自AVBASE的真实演员姓名。</div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">角标</h2>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableBadges" is="emby-checkbox" name="chkEnableBadges" type="checkbox"/>
                            <span>启用角标</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">在海报图上添加中文字幕角标。</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtBadgeUrl">角标URL地址：</label>
                        <input id="txtBadgeUrl" is="emby-input" name="txtBadgeUrl" type="text"/>
                        <div class="fieldDescription">角标URL地址，推荐使用PNG格式。（默认：zimu.png）</div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">图像</h2>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtPrimaryImageRatio">海报图比例：</label>
                        <input id="txtPrimaryImageRatio" is="emby-input" name="txtPrimaryImageRatio" step="any" type="number"/>
                        <div class="fieldDescription">海报图的长宽比，设置负值以使用默认值。</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtDefaultImageQuality">默认图片质量：</label>
                        <input id="txtDefaultImageQuality" is="emby-input" max="100" min="0" name="txtDefaultImageQuality" step="1" type="number"/>
                        <div class="fieldDescription">JPEG图像的默认压缩质量，设置在0到100之间。（默认：90）</div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">电影提供商</h2>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableMovieProviderFilter" is="emby-checkbox" name="chkEnableMovieProviderFilter" type="checkbox"/>
                            <span>启用电影提供商过滤器</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">过滤和重新排序电影提供商的搜索结果。</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtRawMovieProviderFilter">电影提供商过滤器：</label>
                        <input id="txtRawMovieProviderFilter" is="emby-input" name="txtRawMovieProviderFilter" type="text"/>
                        <div class="fieldDescription">提供商名称不区分大小写，优先级从左到右递减，用逗号分隔。</div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">模版</h2>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableTemplate" is="emby-checkbox" name="chkEnableTemplate" type="checkbox"/>
                            <span>启用模版</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription">预定义的模板变量可以在<a class="button-link emby-button" href="https://metatube-community.github.io/wiki/text-template/" is="emby-linkbutton" target="_blank">这里</a>找到。</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtNameTemplate">影片名称：</label>
                        <input id="txtNameTemplate" is="emby-input" name="txtNameTemplate" type="text"/>
                        <div class="fieldDescription">模版变量，例如：{number} {title}</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtTaglineTemplate">标签模板：</label>
                        <input id="txtTaglineTemplate" is="emby-input" name="txtTaglineTemplate" type="text"/>
                        <div class="fieldDescription">可以修改发行日期的标签</div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">翻译</h2>

                    <div class="selectContainer">
                        <label class="selectLabel selectLabelText" for="selectTranslationMode">翻译模式：</label>
                        <select class="emby-select-withcolor emby-select selectTranslationMode" id="selectTranslationMode" is="emby-select" name="selectTranslationMode">
                            <option value="Disabled">关闭</option>
                            <option value="Title">标题</option>
                            <option value="Summary">摘要</option>
                            <option value="Both">标题和摘要</option>
                        </select>
                    </div>

                    <div class="selectTranslationModeEnabled">
                        <div class="selectContainer">
                            <label class="selectLabel selectLabelText" for="selectTranslationEngine">翻译引擎：</label>
                            <select class="emby-select-withcolor emby-select selectTranslationEngine" id="selectTranslationEngine" is="emby-select" name="selectTranslationEngine">
                                <option value="Baidu">百度</option>
                                <option value="Google">谷歌</option>
                                <option value="GoogleFree">谷歌 (免费)</option>
                                <option value="DeepL">DeepL</option>
                                <option value="OpenAi">OpenAI</option>
                            </select>
                        </div>

                        <div class="selectTranslationEngineBaidu">
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtBaiduAppId">百度 app id:</label>
                                <input id="txtBaiduAppId" is="emby-input" name="txtBaiduAppId" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtBaiduAppKey">百度 app key:</label>
                                <input id="txtBaiduAppKey" is="emby-input" name="txtBaiduAppKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                        </div>

                        <div class="selectTranslationEngineGoogle">
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtGoogleApiKey">谷歌 api key:</label>
                                <input id="txtGoogleApiKey" is="emby-input" name="txtGoogleApiKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtGoogleApiUrl">Google api url:</label>
                                <input id="txtGoogleApiUrl" is="emby-input" name="txtGoogleApiUrl" type="text"/>
                                <div class="fieldDescription">自定义 Google 翻译 API 网址。（可选）</div>
                            </div>
                        </div>

                        <div class="selectTranslationEngineDeepL">
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtDeepLApiKey">DeepL api key:</label>
                                <input id="txtDeepLApiKey" is="emby-input" name="txtDeepLApiKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtDeepLApiUrl">DeepL 其它 url (可选):</label>
                                <input id="txtDeepLApiUrl" is="emby-input" name="txtDeepLApiUrl" type="text"/>
                                <div class="fieldDescription">自定义 DeepL 翻译 API 网址。（可选）</div>
                            </div>
                        </div>

                        <div class="selectTranslationEngineOpenAi">
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtOpenAiApiKey">OpenAI api key:</label>
                                <input id="txtOpenAiApiKey" is="emby-input" name="txtOpenAiApiKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtOpenAiApiUrl">OpenAI api url:</label>
                                <input id="txtOpenAiApiUrl" is="emby-input" name="txtOpenAiApiUrl" type="text"/>
                                <div class="fieldDescription">自定义 OpenAI 翻译 API 网址。（可选）</div>
                            </div>
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="txtOpenAiModel">OpenAI model:</label>
                                <input id="txtOpenAiModel" is="emby-input" name="txtOpenAiModel" type="text"/>
                                <div class="fieldDescription">自定义 OpenAI model 网址。（可选）</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">替换</h2>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableTitleSubstitution" is="emby-checkbox" name="chkEnableTitleSubstitution" type="checkbox"/>
                            <span>启用标题替换</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtTitleRawSubstitutionTable">标题替换表：</label>
                        <textarea class="emby-input" id="txtTitleRawSubstitutionTable" is="emby-input" name="txtTitleRawSubstitutionTable" rows="5"></textarea>
                        <div class="fieldDescription">每行一条记录，用等号隔开。将目标标题留空以删除源标题。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableActorSubstitution" is="emby-checkbox" name="chkEnableActorSubstitution" type="checkbox"/>
                            <span>启用演员替换</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtActorRawSubstitutionTable">演员替换表：</label>
                        <textarea class="emby-input" id="txtActorRawSubstitutionTable" is="emby-input" name="txtActorRawSubstitutionTable" rows="5"></textarea>
                        <div class="fieldDescription">每行一条记录，用等号隔开。将目标演员留空以删除源演员。</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableGenreSubstitution" is="emby-checkbox" name="chkEnableGenreSubstitution" type="checkbox"/>
                            <span>启用类型替换</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtGenreRawSubstitutionTable">类型替换表：</label>
                        <textarea class="emby-input" id="txtGenreRawSubstitutionTable" is="emby-input" name="txtGenreRawSubstitutionTable" rows="5"></textarea>
                        <div class="fieldDescription">每行一条记录，用等号隔开。将目标类型留空以删除源类型。</div>
                    </div>
                </div>

                <div>
                    <button class="raised button-submit block" is="emby-button" type="submit">
                        <span>保存设置</span></button>
                </div>

            </form>
        </div>
    </div>
    <script type="text/javascript">
        var MetaTubePluginConfig = {
            pluginUniqueId: "01cc53ec-c415-4108-bbd4-a684a9801a32"
        };

        $('.selectTranslationMode').on('change', function (_) {
            if (this.value === "Disabled") {
                $('.selectTranslationModeEnabled').css('display', 'none');
            } else {
                $('.selectTranslationModeEnabled').css('display', 'inherit');
            }
        });

        $('.selectTranslationEngine').on('change', function (_) {
            if (this.value === "Baidu") {
                $('.selectTranslationEngineBaidu').css('display', 'inherit');
                $('.selectTranslationEngineGoogle').css('display', 'none');
                $('.selectTranslationEngineDeepL').css('display', 'none');
                $('.selectTranslationEngineOpenAi').css('display', 'none');
            } else if (this.value === "Google") {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'inherit');
                $('.selectTranslationEngineDeepL').css('display', 'none');
                $('.selectTranslationEngineOpenAi').css('display', 'none');
            } else if (this.value === "GoogleFree") {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'none');
                $('.selectTranslationEngineDeepL').css('display', 'none');
                $('.selectTranslationEngineOpenAi').css('display', 'none');
            } else if (this.value === "DeepL") {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'none');
                $('.selectTranslationEngineDeepL').css('display', 'inherit');
                $('.selectTranslationEngineOpenAi').css('display', 'none');
            } else if (this.value === "OpenAi") {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'none');
                $('.selectTranslationEngineDeepL').css('display', 'none');
                $('.selectTranslationEngineOpenAi').css('display', 'inherit');
            } else {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'none');
                $('.selectTranslationEngineDeepL').css('display', 'none');
                $('.selectTranslationEngineOpenAi').css('display', 'none');
            }
        });

        $('.MetaTubeConfigurationPage').on('pageshow', function () {
            Dashboard.showLoadingMsg();
            var page = this;
            ApiClient.getPluginConfiguration(MetaTubePluginConfig.pluginUniqueId).then(function (config) {
                $('#txtServer', page).val(config.Server).change();
                $('#txtToken', page).val(config.Token).change();
                page.querySelector('#chkEnableCollections').checked = config.EnableCollections;
                page.querySelector('#chkEnableDirectors').checked = config.EnableDirectors;
                page.querySelector('#chkEnableRatings').checked = config.EnableRatings;
                page.querySelector('#chkEnableTrailers').checked = config.EnableTrailers;
                page.querySelector('#chkEnableRealActorNames').checked = config.EnableRealActorNames;
                page.querySelector('#chkEnableBadges').checked = config.EnableBadges;
                $('#txtBadgeUrl', page).val(config.BadgeUrl).change();
                $('#txtPrimaryImageRatio', page).val(config.PrimaryImageRatio).change();
                $('#txtDefaultImageQuality', page).val(config.DefaultImageQuality).change();
                page.querySelector('#chkEnableMovieProviderFilter').checked = config.EnableMovieProviderFilter;
                $('#txtRawMovieProviderFilter', page).val(config.RawMovieProviderFilter).change();
                page.querySelector('#chkEnableTemplate').checked = config.EnableTemplate;
                $('#txtNameTemplate', page).val(config.NameTemplate).change();
                $('#txtTaglineTemplate', page).val(config.TaglineTemplate).change();
                $('#selectTranslationMode', page).val(config.TranslationMode).change();
                $('#selectTranslationEngine', page).val(config.TranslationEngine).change();
                $('#txtBaiduAppId', page).val(config.BaiduAppId).change();
                $('#txtBaiduAppKey', page).val(config.BaiduAppKey).change();
                $('#txtGoogleApiKey', page).val(config.GoogleApiKey).change();
                $('#txtGoogleApiUrl', page).val(config.GoogleApiUrl).change();
                $('#txtDeepLApiKey', page).val(config.DeepLApiKey).change();
                $('#txtDeepLApiUrl', page).val(config.DeepLApiUrl).change();
                $('#txtOpenAiApiKey', page).val(config.OpenAiApiKey).change();
                $('#txtOpenAiApiUrl', page).val(config.OpenAiApiUrl).change();
                $('#txtOpenAiModel', page).val(config.OpenAiModel).change();
                page.querySelector('#chkEnableTitleSubstitution').checked = config.EnableTitleSubstitution;
                $('#txtTitleRawSubstitutionTable', page).val(config.TitleRawSubstitutionTable).change();
                page.querySelector('#chkEnableActorSubstitution').checked = config.EnableActorSubstitution;
                $('#txtActorRawSubstitutionTable', page).val(config.ActorRawSubstitutionTable).change();
                page.querySelector('#chkEnableGenreSubstitution').checked = config.EnableGenreSubstitution;
                $('#txtGenreRawSubstitutionTable', page).val(config.GenreRawSubstitutionTable).change();
                Dashboard.hideLoadingMsg();
            });
        });

        $('.MetaTubeConfigurationForm').on('submit', function () {
            Dashboard.showLoadingMsg();
            var form = this;
            ApiClient.getPluginConfiguration(MetaTubePluginConfig.pluginUniqueId).then(function (config) {
                config.Server = $('#txtServer', form).val();
                config.Token = $('#txtToken', form).val();
                config.EnableCollections = $('#chkEnableCollections', form).prop('checked');
                config.EnableDirectors = $('#chkEnableDirectors', form).prop('checked');
                config.EnableRatings = $('#chkEnableRatings', form).prop('checked');
                config.EnableTrailers = $('#chkEnableTrailers', form).prop('checked');
                config.EnableRealActorNames = $('#chkEnableRealActorNames', form).prop('checked');
                config.EnableBadges = $('#chkEnableBadges', form).prop('checked');
                config.BadgeUrl = $('#txtBadgeUrl', form).val();
                config.PrimaryImageRatio = $('#txtPrimaryImageRatio', form).val();
                config.DefaultImageQuality = $('#txtDefaultImageQuality', form).val();
                config.EnableMovieProviderFilter = $('#chkEnableMovieProviderFilter', form).prop('checked');
                config.RawMovieProviderFilter = $('#txtRawMovieProviderFilter', form).val();
                config.EnableTemplate = $('#chkEnableTemplate', form).prop('checked');
                config.NameTemplate = $('#txtNameTemplate', form).val();
                config.TaglineTemplate = $('#txtTaglineTemplate', form).val();
                config.TranslationMode = $('#selectTranslationMode', form).val();
                config.TranslationEngine = $('#selectTranslationEngine', form).val();
                config.BaiduAppId = $('#txtBaiduAppId', form).val();
                config.BaiduAppKey = $('#txtBaiduAppKey', form).val();
                config.GoogleApiKey = $('#txtGoogleApiKey', form).val();
                config.GoogleApiUrl = $('#txtGoogleApiUrl', form).val();
                config.DeepLApiKey = $('#txtDeepLApiKey', form).val();
                config.DeepLXAltUrl = $('#txtDeepLApiUrl', form).val();
                config.OpenAiApiKey = $('#txtOpenAiApiKey', form).val();
                config.OpenAiApiUrl = $('#txtOpenAiApiUrl', form).val();
                config.OpenAiModel = $('#txtOpenAiModel', form).val();
                config.EnableTitleSubstitution = $('#chkEnableTitleSubstitution', form).prop('checked');
                config.TitleRawSubstitutionTable = $('#txtTitleRawSubstitutionTable', form).val();
                config.EnableActorSubstitution = $('#chkEnableActorSubstitution', form).prop('checked');
                config.ActorRawSubstitutionTable = $('#txtActorRawSubstitutionTable', form).val();
                config.EnableGenreSubstitution = $('#chkEnableGenreSubstitution', form).prop('checked');
                config.GenreRawSubstitutionTable = $('#txtGenreRawSubstitutionTable', form).val();
                ApiClient.updatePluginConfiguration(MetaTubePluginConfig.pluginUniqueId, config).then(Dashboard.processPluginConfigurationUpdateResult);
            });
            // Disable default form submission
            return false;
        });
    </script>
</div>
</body>
</html>
